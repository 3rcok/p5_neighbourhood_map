function latlng(e,o){return new google.maps.LatLng(e,o)}var infoWindow=new google.maps.InfoWindow,ViewModel=function(){var e=this;this.msgToUser=ko.observable("Pizza Anywhere!"),this.currentAddress=ko.observable("Georgetown Guyana"),this.nearByPlaces=ko.observableArray([]),this.nearByMarkers=ko.observableArray([]),this.numOfNearByPlaces=ko.computed(function(){return this.nearByMarkers().length},this),this.geocode=function(o,n){var a="https://maps.googleapis.com/maps/api/geocode/json?address="+o+"&key=AIzaSyB6tnYAqdRsoSx6iA5m7OV0cdtsGktBtD4";$.getJSON(a,function(){e.msgToUser("Geocoding your location query...")}).success(function(e){var o={};o.lat=e.results[0].geometry.location.lat,o.lng=e.results[0].geometry.location.lng,o.formattedAddress=e.results[0].formatted_address,n(o),console.log("geocode success")})},this.findNearByWithFoursquare=function(o,n,a){var s,t="YW0AAODCCRPPNDUKKQ1KPTDUEERZV3CUSPUMD3FLEUUJP1XQ",r="RPH01ZJ1WAGIPXB3CDAA12ES4CKL10X24XH4FN0TKX21EJFP",i="pizza",l="https://api.foursquare.com/v2/venues/search?client_id="+r+"&client_secret="+t+"&limit=20&v=20130815&ll="+o+","+n+"&query="+i;$.getJSON(l,function(o){s=o.response.venues,s.forEach(function(o){e.nearByMarkers.push(new google.maps.Marker({map:e.map,position:latlng(o.location.lat,o.location.lng),title:o.name,address:o.location.address,url:o.url,id:o.id})),e.nearByPlaces.push(o)})}).success(function(){s.length>0?(e.msgToUser("We found "+e.numOfNearByPlaces()+" pizza places nearby!"),console.log("success: find with foursquare :D"),e.setNearByMarkers(),a&&a()):e.msgToUser("No pizza here. Try another location")})},this.setMarker=function(o,n){var a=new google.maps.Marker({map:e.map,position:latlng(o,n),title:"You are here"});google.maps.event.addListener(a,"click",function(o){return function(){infoWindow.setContent("You are here"),infoWindow.open(e.map,o)}}(a))},this.setNearByMarkers=function(){var o,n,a=new google.maps.LatLngBounds,s=e.nearByPlaces();s.forEach(function(s){n={map:e.map,position:latlng(s.location.lat,s.location.lng),title:s.name,address:s.location.address,icon:"images/pizzaMarker.png",id:s.id},o=new google.maps.Marker(n),a.extend(o.getPosition()),google.maps.event.addListener(o,"click",function(o){return function(){console.log(o.id),infoWindow.setContent('<div class="place-wrapper"><h5 class="name">'+o.title+'</h5><div class="address">'+o.address+"</div></div>"),infoWindow.open(e.map,o)}}(o)),e.map.fitBounds(a)})},this.goToMarker=function(o){console.log(o),e.map.setCenter(latlng(o.position.k,o.position.D)),infoWindow.setContent('<div class="place-wrapper"><h5 class="name">'+o.title+'</h5><div class="address">'+o.address+"</div></div>"),infoWindow.open(e.map,o)},this.markerZoomIn=function(){e.map.setZoom(e.map.zoom+1)},this.markerZoomOut=function(){e.map.setZoom(e.map.zoom-1)},e.goTo=function(o){var n=o.lat,a=o.lng;e.currentAddress(o.formattedAddress),e.setMarker(n,a),e.msgToUser("Looking for nearby places..."),e.findNearByWithFoursquare(n,a,function(){}),e.map.setCenter(latlng(n,a))},e.handleLocationInput=function(){var o=e.currentAddress();e.nearByMarkers([]),e.nearByPlaces([]),e.geocode(o,e.goTo)};var o,n;o=document.getElementById("map"),n={zoom:9,center:latlng(37.7831,-122.4039),disableDefaultUI:!0},e.map=new google.maps.Map(o,n)};ko.applyBindings(new ViewModel);