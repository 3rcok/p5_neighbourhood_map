function latlng(e,o){return new google.maps.LatLng(e,o)}var infoWindow=new google.maps.InfoWindow,ViewModel=function(){var e=this;this.msgToUser=ko.observable("Where are we eating?"),this.currentAddress=ko.observable("Upper Manhattan, New York, NY, USA"),this.nearByPlaces=ko.observableArray([]),this.nearByMarkers=ko.observableArray([]),this.numOfNearByPlaces=ko.computed(function(){return this.nearByPlaces().length},this),this.currentPlacePhotos=ko.observableArray([]),this.geocode=function(e,o){var s="https://maps.googleapis.com/maps/api/geocode/json?address="+e+"&key=AIzaSyB6tnYAqdRsoSx6iA5m7OV0cdtsGktBtD4";$.getJSON(s,function(){}).success(function(e){var s={};s.lat=e.results[0].geometry.location.lat,s.lng=e.results[0].geometry.location.lng,s.formattedAddress=e.results[0].formatted_address,o(s)})},this.findNearByWithFoursquare=function(o,s,t){var n,i="YW0AAODCCRPPNDUKKQ1KPTDUEERZV3CUSPUMD3FLEUUJP1XQ",a="RPH01ZJ1WAGIPXB3CDAA12ES4CKL10X24XH4FN0TKX21EJFP",r="pizza",l="https://api.foursquare.com/v2/venues/search?client_id="+a+"&client_secret="+i+"&v=20130815&ll="+o+","+s+"&query="+r;e.msgToUser("Looking for pizza nearby..."),$.getJSON(l,function(o){n=o.response.venues,n.forEach(function(o){e.nearByMarkers.push(new google.maps.Marker({map:e.map,position:latlng(o.location.lat,o.location.lng),title:o.name,address:o.location.address,city:o.location.city,contact:o.contact.formattedPhone,url:o.url,id:o.id})),e.nearByPlaces.push(o)})}).success(function(){n.length>0?(e.msgToUser("We found "+e.numOfNearByPlaces()+" pizza places nearby!"),e.setNearByMarkers(),t&&t()):e.msgToUser("No pizza here. Try another location")})},this.slick=function(){$(".photos").slick({dots:!0,infinite:!1,speed:300,slidesToShow:4,slidesToScroll:4,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:3,infinite:!0,dots:!0}},{breakpoint:600,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}]}),console.log("slicked")},this.unslick=function(){$(".photos").unslick()},this.clearPhotos=function(){e.currentPlacePhotos([])},this.getPlacePhotos=function(o){e.clearPhotos(),e.unslick();var s=o.id,t=15,n="YW0AAODCCRPPNDUKKQ1KPTDUEERZV3CUSPUMD3FLEUUJP1XQ",i="RPH01ZJ1WAGIPXB3CDAA12ES4CKL10X24XH4FN0TKX21EJFP",a="https://api.foursquare.com/v2/venues/"+s+"/photos?client_id="+i+"&client_secret="+n+"&limit="+t+"&v=20130815";$.getJSON(a,function(o){var s,t,n,i=o.response.photos.items,a="200x200";i.forEach(function(o){s=o.prefix,t=o.suffix,n=s+a+t,e.currentPlacePhotos.push(n)}),console.log(e.currentPlacePhotos()),console.log("self.currentPlacePhotos().length: "+e.currentPlacePhotos().length)}).success(function(){$(".photos").slick({dots:!0,infinite:!1,speed:300,slidesToShow:4,slidesToScroll:4,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:3,infinite:!0,dots:!0}},{breakpoint:600,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}]}),console.log("slicked")})},this.setCurrentLocationMarker=function(o,s){var t=new google.maps.Marker({map:e.map,position:latlng(o,s),title:"You are here"});google.maps.event.addListener(t,"click",function(o){return function(){infoWindow.setContent("You are here"),infoWindow.open(e.map,o)}}(t))},this.setNearByMarkers=function(){var o,s,t=new google.maps.LatLngBounds,n=e.nearByPlaces();n.forEach(function(n){s={map:e.map,position:latlng(n.location.lat,n.location.lng),title:n.name,address:n.location.address,id:n.id},o=new google.maps.Marker(s),o.setIcon("images/pizzaMarker.png"),t.extend(o.getPosition()),google.maps.event.addListener(o,"click",function(o){return function(){var s='<div class="place-wrapper"><h5 class="name">'+o.title+'</h5><div class="address">'+o.address+"</div></div>";infoWindow.setContent(s),infoWindow.open(e.map,o)}}(o)),e.map.fitBounds(t)})},this.goToMarker=function(o){e.map.setCenter(latlng(o.position.k,o.position.D));var s='<div class="place-wrapper"><h5 class="name">'+o.title+'</h5><div class="address">'+o.address+"</div></div>";infoWindow.setContent(s),infoWindow.open(e.map,o)},this.markerZoomIn=function(){e.map.setZoom(16)},e.goTo=function(o){var s=o.lat,t=o.lng;e.currentAddress(o.formattedAddress),e.setCurrentLocationMarker(s,t),e.findNearByWithFoursquare(s,t,function(){$(".clickable").click(function(){$(".clickable").removeClass("active"),$(this).addClass("active")})}),e.map.setCenter(latlng(s,t))},e.handleLocationInput=function(){var o=e.currentAddress();e.nearByMarkers([]),e.nearByPlaces([]),e.msgToUser("Geocoding your location query..."),o?e.geocode(o,e.goTo):e.msgToUser("Enter an address, neighbourhood or city...")};var o,s;o=document.getElementById("map"),s={zoom:9,center:latlng(37.7831,-122.4039),disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER}},e.map=new google.maps.Map(o,s)};ko.applyBindings(new ViewModel);