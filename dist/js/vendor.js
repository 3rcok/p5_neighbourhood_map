function latlng(o,e){return new google.maps.LatLng(o,e)}var infoWindow=new google.maps.InfoWindow,ViewModel=function(){var o=this;this.msgToUser=ko.observable("Find Pizza Anywhere"),this.currentAddress=ko.observable("2465 Latham Street, Mountain View, CA"),this.nearByPlaces=ko.observableArray([]),this.nearByMarkers=ko.observableArray([]),this.numOfNearByPlaces=ko.computed(function(){return this.nearByPlaces().length},this),this.currentPlacePhotos=ko.observableArray([]),this.photosMessage=ko.observable(),this.geocode=function(e,t){var s="https://maps.googleapis.com/maps/api/geocode/json?address="+e+"&key=AIzaSyB6tnYAqdRsoSx6iA5m7OV0cdtsGktBtD4";$.getJSON(s,function(){}).success(function(o){var e={};e.lat=o.results[0].geometry.location.lat,e.lng=o.results[0].geometry.location.lng,e.formattedAddress=o.results[0].formatted_address,t(e)}).fail(function(){o.msgToUser("Oops. We could not geocode your location.")})},this.findNearByWithFoursquare=function(e,t,s){var n,a="YW0AAODCCRPPNDUKKQ1KPTDUEERZV3CUSPUMD3FLEUUJP1XQ",i="RPH01ZJ1WAGIPXB3CDAA12ES4CKL10X24XH4FN0TKX21EJFP",r="pizza",l="https://api.foursquare.com/v2/venues/search?client_id="+i+"&client_secret="+a+"&v=20130815&ll="+e+","+t+"&query="+r;o.msgToUser("Looking for pizza nearby..."),$.getJSON(l,function(e){n=e.response.venues,n.forEach(function(e){o.nearByMarkers.push(new google.maps.Marker({map:o.map,position:latlng(e.location.lat,e.location.lng),title:e.name,address:e.location.address,city:e.location.city,contact:e.contact.formattedPhone,url:e.url,id:e.id})),o.nearByPlaces.push(e)})}).success(function(){n.length>0?(o.msgToUser("We found "+o.numOfNearByPlaces()+" pizza places nearby!"),o.setNearByMarkers(),s&&s()):o.msgToUser("No pizza here. Try another location")})},this.slick=function(){$(".photos").slick({dots:!1,infinite:!1,speed:300,slidesToShow:4,slidesToScroll:4,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:3,infinite:!0,dots:!0}},{breakpoint:600,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}]})},this.unslick=function(){$(".photos").unslick()},this.clearPhotos=function(){o.currentPlacePhotos([])},this.resetSlick=function(){o.unslick(),o.clearPhotos()},this.getPlacePhotos=function(e){o.photosMessage("Looking for photos..."),o.resetSlick();var t=e.id,s=(e.title,15),n="YW0AAODCCRPPNDUKKQ1KPTDUEERZV3CUSPUMD3FLEUUJP1XQ",a="RPH01ZJ1WAGIPXB3CDAA12ES4CKL10X24XH4FN0TKX21EJFP",i="https://api.foursquare.com/v2/venues/"+t+"/photos?client_id="+a+"&client_secret="+n+"&limit="+s+"&v=20130815";$.getJSON(i,function(t){var s,n,a,i=t.response.photos.items,r="200x200";o.photosMessage(0===i.length?"No photos found of "+e.title:"Found "+i.length+" photos of "+e.title),i.forEach(function(e){s=e.prefix,n=e.suffix,a=s+r+n,o.currentPlacePhotos.push(a)}),console.log(o.currentPlacePhotos()),console.log("self.currentPlacePhotos().length: "+o.currentPlacePhotos().length)}).success(function(){o.slick()})},this.setCurrentLocationMarker=function(e,t){var s=new google.maps.Marker({map:o.map,position:latlng(e,t),title:"You are here"});google.maps.event.addListener(s,"click",function(e){return function(){infoWindow.setContent("You are here"),infoWindow.open(o.map,e)}}(s))},this.setNearByMarkers=function(){var e,t,s=new google.maps.LatLngBounds,n=o.nearByPlaces();n.forEach(function(n){t={map:o.map,position:latlng(n.location.lat,n.location.lng),title:n.name,address:n.location.address,id:n.id,phone:n.contact.formattedPhone,icon:"images/pizzaMarker.png"},e=new google.maps.Marker(t),s.extend(e.getPosition()),google.maps.event.addListener(e,"click",function(e){return function(){var t='<div class="place-wrapper"><h5 class="name">'+e.title+'</h5><div class="address">'+e.address+'</div><div class="phone">'+e.contact+"</div></div>";infoWindow.setContent(t),infoWindow.open(o.map,e)}}(e)),o.map.fitBounds(s)})},this.goToMarker=function(e){console.log(e),o.resetSlick(),o.map.setCenter(latlng(e.position.k,e.position.D)),e.contact||(e.contact="No contact available"),e.address||(e.address="No address available");var t='<div class="place-wrapper"><h5 class="name">'+e.title+'</h5><div class="address">'+e.address+'</div><div class="phone">'+e.contact+"</div></div>";infoWindow.setContent(t),infoWindow.open(o.map,e)},this.markerZoomIn=function(){o.map.setZoom(16)},o.goTo=function(e){var t=e.lat,s=e.lng;o.resetSlick(),o.currentAddress(e.formattedAddress),o.setCurrentLocationMarker(t,s),o.findNearByWithFoursquare(t,s,function(){$(".clickable").click(function(){$(".clickable").removeClass("active"),$(this).addClass("active")})}),o.map.setCenter(latlng(t,s))},o.handleLocationInput=function(){var e=o.currentAddress();o.nearByMarkers([]),o.nearByPlaces([]),o.msgToUser("Trying to understand what you're saying"),e?o.geocode(e,o.goTo):o.msgToUser("Enter an address, neighbourhood or city...")};var e,t;e=document.getElementById("map"),t={zoom:9,center:latlng(37.7831,-122.4039),disableDefaultUI:!0,scrollwheel:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER}},o.map=new google.maps.Map(e,t)};ko.applyBindings(new ViewModel);